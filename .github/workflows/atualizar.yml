name: Atualizar METAR/TAF

on:
  schedule:
    - cron: '0 * * * *'  # corre de hora a hora
  workflow_dispatch:

jobs:
  atualizar:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar reposit√≥rio
        uses: actions/checkout@v3

      - name: Buscar dados METAR/TAF e gerar JSON
        run: |
          mkdir -p dados
          rm -f dados/*.json

          for ICAO in LPPT LPFR LPPR LPCS LPMR LPPD LPSJ LPAV LPVZ KJFK KLAX KORD; do
            echo "üîÑ A processar $ICAO..."

            METAR=$(curl -s "https://tgftp.nws.noaa.gov/data/observations/metar/stations/${ICAO}.TXT" | grep "^METAR")
            TAF=$(curl -s "https://tgftp.nws.noaa.gov/data/forecasts/taf/stations/${ICAO}.TXT" | grep "^TAF")

            # Verifica√ß√£o de conte√∫do
            if [ -z "$METAR" ]; then
              METAR="METAR n√£o dispon√≠vel para ${ICAO}"
              echo "‚ö†Ô∏è METAR vazio para $ICAO"
            fi

            if [ -z "$TAF" ]; then
              TAF="TAF n√£o dispon√≠vel para ${ICAO}"
              echo "‚ö†Ô∏è TAF vazio para $ICAO"
            fi

            echo "{\"icao\":\"$ICAO\",\"metar\":\"$METAR\"}" > dados/metar-$ICAO.json
            echo "{\"icao\":\"$ICAO\",\"taf\":\"$TAF\"}" > dados/taf-$ICAO.json
          done

          echo "‚úÖ Ficheiros gerados:"
          ls -lh dados/

      - name: Commit e push autom√°tico
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Atualiza√ß√£o autom√°tica METAR/TAF"
          file_pattern: dados/*.json
