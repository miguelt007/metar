<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Painel METAR / TAF</title>
  <style>
    body {
      font-family: sans-serif;
      background: #1e1e2f;
      color: #fff;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #007acc;
      color: white;
    }
    .card {
      background: #2e2e3e;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
    }
    .card.severe {
      background: #8b0000;
    }
    pre {
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>Painel METAR / TAF</h2>
  <input type="text" id="icaoInput" placeholder="Escreve ICAO (ex: LPPT)">
  <button onclick="buscar()">Buscar</button>
  <div id="panel"></div>

  <script>
    function buscar() {
      const icao = document.getElementById("icaoInput").value.trim().toUpperCase();
      if (icao.length !== 4) {
        alert("Insere um ICAO v√°lido com 4 letras.");
        return;
      }

      document.getElementById("panel").innerHTML = "<p>A carregar...</p>";

      Promise.all([
        fetch(`dados/metar-${icao}.json`).then(r => r.ok ? r.json() : Promise.reject("METAR n√£o dispon√≠vel")),
        fetch(`dados/taf-${icao}.json`).then(r => r.ok ? r.json() : Promise.reject("TAF n√£o dispon√≠vel"))
      ]).then(([metar, taf]) => {
        document.getElementById("panel").innerHTML = "";
        mostrar("üõ¨ METAR", metar.metar);
        mostrar("üìã TAF", taf.taf);
      }).catch(err => {
        document.getElementById("panel").innerHTML = `<p>‚ùå ${err} para ${icao}</p>`;
      });
    }

    function mostrar(titulo, texto) {
      const alerta = /TS|0000|PROB[4-9]|\$/.test(texto);
      const div = document.createElement("div");
      div.className = "card" + (alerta ? " severe" : "");
      div.innerHTML = `<strong>${titulo}</strong><pre>${traduzir(texto)}</pre>`;
      document.getElementById("panel").appendChild(div);
    }

    function traduzir(t) {
      if (!t || !t.includes("Z")) return "‚ö†Ô∏è Dados n√£o encontrados.";
      return t
        .replace(/(\d{6}Z)/, "üïí $1\n")
        .replace(/(\d{3})(\d{2})KT/, "üí® Vento $1¬∞ a $2 n√≥s\n")
        .replace(/CAVOK/, "üå§Ô∏è C√©u limpo\n")
        .replace(/Q(\d{4})/, "üìâ Press√£o: $1 hPa\n")
        .replace(/RMK (.+)/, "üìå RMK: $1\n");
    }
  </script>
</body>
</html>
