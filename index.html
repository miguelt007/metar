<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Painel METAR / TAF</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #1e1e2f; color: #fff; padding: 30px; margin: 0; }
    h1 { text-align: center; }
    .card { background: #2e2e3e; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #000; margin-top: 20px; }
    .card.severe { background: #8b0000; border: 2px solid #ff4c4c; }
    .card h2 { margin-top: 0; font-size: 18px; }
    .card span { font-size: 16px; display: block; margin-top: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Painel METAR / TAF</h1>
  <div id="panel"></div>

  <script>
    Promise.all([
      fetch("metar.json").then(res => res.json()),
      fetch("taf.json").then(res => res.json())
    ]).then(([metarData, tafData]) => {
      renderCard(`🛬 METAR ${metarData.icao}`, traduzirTexto(metarData.metar), metarData.metar.includes("+RA") || metarData.metar.includes("TS") || metarData.metar.includes("1300"));
      renderCard(`📋 TAF ${tafData.icao}`, traduzirTexto(tafData.taf), tafData.taf.includes("TS") || tafData.taf.includes("PROB"));
    });

    function renderCard(titulo, texto, severo = false) {
      const div = document.createElement("div");
      div.className = "card" + (severo ? " severe" : "");
      div.innerHTML = `<h2>${titulo}</h2><span>${texto}</span>`;
      document.getElementById("panel").appendChild(div);
    }

    function traduzirTexto(texto) {
      return texto
        .replace(/(\d{6}Z)/g, "🕒 Observado às $1")
        .replace(/(\d{3})(\d{2})KT/g, "💨 Vento de $1° a $2 nós")
        .replace(/CAVOK/g, "🌤️ Céu limpo, visibilidade >10km")
        .replace(/(\d{4})/g, "👁️ Visibilidade: $1 metros")
        .replace(/(FEW|SCT|BKN|OVC)(\d{3})/g, (_, tipo, alt) => {
          const map = { FEW: "Poucas", SCT: "Dispersas", BKN: "Fragmentadas", OVC: "Encoberto" };
          return `☁️ Nuvens ${map[tipo]} a ${parseInt(alt) * 100} pés`;
        })
        .replace(/Q(\d{4})/g, "📉 Pressão: $1 hPa")
        .replace(/(\d{2})\/(\d{2})/g, "🌡️ Temperatura: $1°C / Ponto de orvalho: $2°C")
        .replace(/NOSIG/g, "🔮 Sem mudanças significativas")
        .replace(/(-|\+)?(RA|SN|FG|BR|TS|DZ|GR)/g, (_, int, fen) => {
          const map = { RA: "chuva", SN: "neve", FG: "nevoeiro", BR: "névoa", TS: "trovoada", DZ: "chuvisco", GR: "granizo" };
          const intensidade = int === "+" ? "forte" : int === "-" ? "fraca" : "moderada";
          return `🌧️ ${map[fen]} ${intensidade}`;
        })
        .replace(/BECMG/g, "🔄 Mudança gradual esperada")
        .replace(/TEMPO/g, "🔄 Condições temporárias")
        .replace(/FM(\d{6})/g, (_, hora) => `🕒 A partir de ${hora.slice(0,2)}/${hora.slice(2,4)}:${hora.slice(4,6)} UTC`)
        .replace(/PROB(\d{2})/g, (_, prob) => `📊 Probabilidade ${prob}%`);
    }
  </script>
</body>
</html>
