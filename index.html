<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Painel METAR / TAF</title>
  <style>
    body {
      font-family: sans-serif;
      background: #1e1e2f;
      color: #fff;
      padding: 20px;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #007acc;
      color: white;
    }
    .card {
      background: #2e2e3e;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
    }
    .card.severe {
      background: #8b0000;
    }
    .linha {
      margin: 5px 0;
      display: flex;
      align-items: center;
    }
    .linha span {
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <h2>Painel METAR / TAF</h2>
  <input type="text" id="icaoInput" placeholder="Escreve ICAO (ex: LPPT)">
  <button onclick="buscar()">Buscar</button>
  <div id="panel"></div>

  <script>
    function buscar() {
      const icao = document.getElementById("icaoInput").value.trim().toUpperCase();
      if (icao.length !== 4) {
        alert("Insere um ICAO vÃ¡lido com 4 letras.");
        return;
      }

      document.getElementById("panel").innerHTML = "<p>A carregar...</p>";

      Promise.all([
        fetch(`dados/metar-${icao}.json`).then(r => r.ok ? r.json() : Promise.reject("METAR nÃ£o disponÃ­vel")),
        fetch(`dados/taf-${icao}.json`).then(r => r.ok ? r.json() : Promise.reject("TAF nÃ£o disponÃ­vel"))
      ]).then(([metar, taf]) => {
        document.getElementById("panel").innerHTML = "";
        mostrar("ğŸ›¬ METAR", metar.metar);
        mostrar("ğŸ“‹ TAF", taf.taf);
      }).catch(err => {
        document.getElementById("panel").innerHTML = `<p>âŒ ${err} para ${icao}</p>`;
      });
    }

    function mostrar(titulo, texto) {
      const alerta = /TS|0000|PROB[4-9]|\$/.test(texto);
      const div = document.createElement("div");
      div.className = "card" + (alerta ? " severe" : "");
      div.innerHTML = `<strong>${titulo}</strong>`;
      const linhas = traduzir(texto);
      linhas.forEach(l => {
        const linha = document.createElement("div");
        linha.className = "linha";
        linha.innerHTML = `<span>${l}</span>`;
        div.appendChild(linha);
      });
      document.getElementById("panel").appendChild(div);
    }

    function traduzir(t) {
      if (!t || !t.includes("Z")) return ["âš ï¸ Dados nÃ£o encontrados."];
      const linhas = [];

      const zulu = t.match(/\d{6}Z/);
      if (zulu) linhas.push(`ğŸ•’ Observado Ã s ${zulu[0]} UTC`);

      const vento = t.match(/(\d{3})(\d{2})KT/);
      if (vento) linhas.push(`ğŸ’¨ Vento de ${vento[1]}Â° a ${vento[2]} nÃ³s`);

      const varVento = t.match(/\d{3}V\d{3}/);
      if (varVento) linhas.push(`â†”ï¸ Vento variÃ¡vel: ${varVento[0]}`);

      if (/CAVOK/.test(t)) linhas.push("ğŸŒ¤ï¸ CÃ©u limpo, visibilidade >10km");

      const vis = t.match(/\d{4}(?!\/)/);
      if (vis) linhas.push(`ğŸ‘ï¸ Visibilidade: ${vis[0]} metros`);

      const temp = t.match(/(\d{2})\/(\d{2})/);
      if (temp) linhas.push(`ğŸŒ¡ï¸ Temperatura: ${temp[1]}Â°C / Ponto de orvalho: ${temp[2]}Â°C`);

      const press = t.match(/Q(\d{4})/);
      if (press) linhas.push(`ğŸ“‰ PressÃ£o: ${press[1]} hPa`);

      const nuvens = [...t.matchAll(/(FEW|SCT|BKN|OVC)(\d{3})/g)];
      nuvens.forEach(n => {
        const map = { FEW: "Poucas", SCT: "Dispersas", BKN: "Fragmentadas", OVC: "Encoberto" };
        linhas.push(`â˜ï¸ Nuvens ${map[n[1]]} a ${parseInt(n[2]) * 100} pÃ©s`);
      });

      const fenos = [...t.matchAll(/(-|\+)?(RA|SN|FG|BR|TS|DZ|GR)/g)];
      fenos.forEach(f => {
        const map = {
          RA: "chuva", SN: "neve", FG: "nevoeiro", BR: "nÃ©voa",
          TS: "trovoada", DZ: "chuvisco", GR: "granizo"
        };
        const intensidade = f[1] === "+" ? "forte" : f[1] === "-" ? "fraca" : "moderada";
        linhas.push(`ğŸŒ§ï¸ ${map[f[2]]} ${intensidade}`);
      });

      if (/NOSIG/.test(t)) linhas.push("ğŸ”® Sem mudanÃ§as significativas");
      if (/BECMG/.test(t)) linhas.push("ğŸ”„ MudanÃ§a gradual esperada");
      if (/TEMPO/.test(t)) linhas.push("ğŸ”„ CondiÃ§Ãµes temporÃ¡rias");

      const prob = t.match(/PROB(\d{2})/);
      if (prob) linhas.push(`ğŸ“Š Probabilidade ${prob[1]}%`);

      const rmk = t.match(/RMK (.+)/);
      if (rmk) linhas.push(`ğŸ“Œ ObservaÃ§Ãµes: ${rmk[1]}`);

      return linhas;
    }
  </script>
</body>
</html>
